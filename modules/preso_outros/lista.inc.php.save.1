<?php

$mostrar=$_REQUEST['mostrar'];

include ("menu.inc.php");
include ("filtro.inc.php");

if ($_SESSION['debug']) pre("Mostrar: $mostrar");

if ($mostrar=="presos") $sqlWhere[]=" fim_data = '0000-00-00'";
if ($mostrar=="soltos") $sqlWhere[]=" fim_data != '0000-00-00' ";

if ($user['nivel']<4) {
	$sqlWhere[]=" opm2.CODIGOBASE LIKE '".$opm_login->codigoBase."%' OR cdopm_prisao LIKE ''";
}

$sql="SELECT preso.*, presotipo.presotipo, RHPARANA.opmPMPR.ABREVIATURA, opm2.ABREVIATURA opmatual, opm2.CODIGOBASE opmatualcd FROM preso LEFT JOIN presotipo ON presotipo.id_presotipo = preso.id_presotipo
	LEFT JOIN RHPARANA.opmPMPR ON preso.cdopm_prisao=RHPARANA.opmPMPR.CODIGOBASE
	LEFT JOIN RHPARANA.POLICIAL pm ON pm.rg=preso.rg
	LEFT JOIN RHPARANA.opmPMPR opm2 ON pm.opm_meta4 = opm2.META4
";
include ("includes/filtro.php");
?>

<br>
<div class='bordasimples'>
<table border=0 width="100%" class='bordasimples'>

<?php
if ($opcao=="listar") echo "<tr><td colspan='10'><h2>Presos cadastrados</h2></td></tr>";
else echo "<tr><td colspan='10'><h2>Resultado</h2></td></tr>";

//Cabecalho
echo "<tr>";
	//Descomente as linhas abaixo, primeiro parametro=nome legivel, segundo=nome do campo na tabela.
	lista::td("Nome","nome");
	lista::td("OPM atual","opmatual");
	lista::td("Local da pris&atilde;o","local");
	lista::td("Tipo","presotipo");
	lista::td("In&iacute;cio","inicio_data");
	lista::td("T&eacute;rmino","fim_data");
	lista::td("Vara/Comarca","vara");

	//echo "<td><b>Ação</b></td>"; //Comente caso nao seja necessario

echo "</tr>\r\n";

//executa a query no servidor
$res=mysql_query($sql);

$i=0; //contador

//Imprime linha a linha todos os resultados da query
while ($row=mysql_fetch_array($res)) {

	//muda a cor para cada linha
	$i%2?($cor=white):($cor='#EEEEEE');
	
	openTR("bgcolor='$cor'");

	echo "<td>".lista::link("atualizar").$row["cargo"]." $row[nome]</a></td>";
	
	//Substitua "campo" pelo nome do campo na tabela, tantos quanto precisar
	
	echo "<td>$row[opmatual]</td>";

	if ($row[local]=="civil") echo "<td>".$row["localreclusao"]."</td>";
	else echo "<td>$row[ABREVIATURA]</td>";

	echo "<td>".$row["presotipo"]."</td>";
	echo "<td>".data::inverte($row["inicio_data"])."</td>";

	if ($row['fim_data']!="0000-00-00") echo "<td>".data::inverte($row["fim_data"])."</td>";
	else echo "<td><h3>&nbsp;PRESO</h3></td>";

	echo "<td>".$row["vara"]." - ".$row[comarca]."</td>";

	closeTR();
$i++;
}
//Imprime a quantidade encontrada, no final da tabela
echo "<tr><td colspan='10'><h1>Total: $i</h1></td></tr>";
?>
</table>
</div>
<br>
